<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Pain Tracker">
  <title>Pain Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="module">
    import React, { useState, useEffect } from 'https://cdn.skypack.dev/react';
    import ReactDOM from 'https://cdn.skypack.dev/react-dom';
    
    const PainTrackerApp = () => {
      const [currentDate, setCurrentDate] = useState(new Date());
      const [selectedDate, setSelectedDate] = useState(null);
      const [entries, setEntries] = useState({});
      const [currentEntry, setCurrentEntry] = useState(null);
      const [activeView, setActiveView] = useState('calendar');
      const [darkMode, setDarkMode] = useState(false);

      useEffect(() => {
        try {
          const e = localStorage.getItem('entries');
          if (e) setEntries(JSON.parse(e));
          const d = localStorage.getItem('dark');
          if (d) setDarkMode(JSON.parse(d));
        } catch (err) {}
      }, []);

      useEffect(() => {
        if (selectedDate) {
          const key = `${selectedDate.getFullYear()}-${selectedDate.getMonth()}-${selectedDate.getDate()}`;
          setCurrentEntry(entries[key] || { painLevels: [], sleep: { quality: null, naps: [] }, locations: [], triggers: [], notes: '', medications: '' });
        }
      }, [selectedDate, entries]);

      const painLevels = [
        { level: 10, color: 'bg-purple-600', title: 'Excruciating', desc: 'Take me to the ER' },
        { level: 9, color: 'bg-red-900', title: 'Severe', desc: "Can't think about anything else" },
        { level: 8, color: 'bg-red-600', title: 'Intense', desc: 'Hard to think, talk, or listen' },
        { level: 7, color: 'bg-orange-500', title: 'Barely Manageable', desc: 'Prevents activities' },
        { level: 6, color: 'bg-yellow-400', title: 'Distressing', desc: 'Think about it continually' }
      ];

      const save = () => {
        if (!selectedDate || !currentEntry) return;
        const key = `${selectedDate.getFullYear()}-${selectedDate.getMonth()}-${selectedDate.getDate()}`;
        const newEntries = { ...entries, [key]: currentEntry };
        localStorage.setItem('entries', JSON.stringify(newEntries));
        setEntries(newEntries);
        setSelectedDate(null);
      };

      const getColor = (date) => {
        const key = `${date.getFullYear()}-${date.getMonth()}-${date.getDate()}`;
        const entry = entries[key];
        if (!entry?.painLevels?.length) return darkMode ? 'bg-green-900 text-green-100' : 'bg-green-100 text-green-800';
        const max = Math.max(...entry.painLevels);
        return (painLevels.find(p => p.level === max)?.color || 'bg-green-100') + ' text-white';
      };

      const bg = darkMode ? 'bg-gray-900' : 'bg-gray-50';
      const card = darkMode ? 'bg-gray-800' : 'bg-white';
      const text = darkMode ? 'text-white' : 'text-gray-800';
      const muted = darkMode ? 'text-gray-400' : 'text-gray-600';
      const border = darkMode ? 'border-gray-700' : 'border-gray-200';

      if (selectedDate && currentEntry) {
        return React.createElement('div', { className: `max-w-2xl mx-auto ${bg} min-h-screen` },
          React.createElement('div', { className: `${card} p-4 flex justify-between items-center` },
            React.createElement('h2', { className: `text-xl font-medium ${text}` }, selectedDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric' })),
            React.createElement('button', { onClick: () => setSelectedDate(null), className: 'text-blue-600' }, 'Cancel')
          ),
          React.createElement('div', { className: 'p-4 space-y-6 pb-24' },
            React.createElement('div', null,
              React.createElement('h3', { className: `text-lg font-medium mb-3 ${text}` }, 'Pain Level'),
              painLevels.map(({ level, color, title, desc }) =>
                React.createElement('button', {
                  key: level,
                  onClick: () => setCurrentEntry({ ...currentEntry, painLevels: currentEntry.painLevels.includes(level) ? currentEntry.painLevels.filter(l => l !== level) : [...currentEntry.painLevels, level] }),
                  className: `w-full text-left p-4 rounded-lg border-2 mb-2 ${currentEntry.painLevels.includes(level) ? `${color} text-white` : `${card} ${border}`}`
                },
                  React.createElement('div', { className: 'flex gap-3' },
                    React.createElement('span', { className: 'text-3xl font-bold' }, level),
                    React.createElement('div', null,
                      React.createElement('div', { className: 'font-medium' }, title),
                      React.createElement('div', { className: 'text-sm opacity-90' }, desc)
                    )
                  )
                )
              )
            ),
            React.createElement('div', null,
              React.createElement('h3', { className: `text-lg font-medium mb-3 ${text}` }, 'Sleep'),
              React.createElement('div', { className: 'flex gap-2 mb-3' },
                ['Amazing', 'Good', 'Okay', 'Poor'].map(q =>
                  React.createElement('button', {
                    key: q,
                    onClick: () => setCurrentEntry({ ...currentEntry, sleep: { ...currentEntry.sleep, quality: q }}),
                    className: `px-4 py-2 rounded-full font-medium ${currentEntry.sleep.quality === q ? (q === 'Amazing' ? 'bg-green-500' : q === 'Good' ? 'bg-green-400' : q === 'Okay' ? 'bg-yellow-400' : 'bg-red-500') + ' text-white' : darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-100 text-gray-700'}`
                  }, q)
                )
              ),
              React.createElement('div', { className: 'flex gap-2' },
                ['Morning', 'Afternoon', 'Evening'].map(t =>
                  React.createElement('button', {
                    key: t,
                    onClick: () => setCurrentEntry({ ...currentEntry, sleep: { ...currentEntry.sleep, naps: currentEntry.sleep.naps.includes(t) ? currentEntry.sleep.naps.filter(n => n !== t) : [...currentEntry.sleep.naps, t] }}),
                    className: `px-4 py-2 rounded-lg border-2 ${currentEntry.sleep.naps.includes(t) ? 'bg-blue-500 text-white' : `${card} ${border} ${text}`}`
                  }, t)
                )
              )
            ),
            React.createElement('div', null,
              React.createElement('h3', { className: `text-lg font-medium mb-3 ${text}` }, 'Location'),
              React.createElement('div', { className: 'flex gap-2 flex-wrap' },
                ['Forehead', 'Temple', 'Back of Head', 'Top of Head'].map(l =>
                  React.createElement('button', {
                    key: l,
                    onClick: () => setCurrentEntry({ ...currentEntry, locations: currentEntry.locations.includes(l) ? currentEntry.locations.filter(x => x !== l) : [...currentEntry.locations, l] }),
                    className: `px-4 py-2 rounded-lg border-2 ${currentEntry.locations.includes(l) ? 'bg-blue-500 text-white' : `${card} ${border} ${text}`}`
                  }, l)
                )
              )
            ),
            React.createElement('div', null,
              React.createElement('h3', { className: `text-lg font-medium mb-3 ${text}` }, 'Triggers'),
              React.createElement('div', { className: 'flex gap-2 flex-wrap' },
                ['Stress', 'Weather', 'Sleep Deprivation', 'Caffeine', 'Alcohol', 'Bright Lights', 'Loud Noise', 'Screen Time', 'Skipped Meal', 'Exercise'].map(t =>
                  React.createElement('button', {
                    key: t,
                    onClick: () => setCurrentEntry({ ...currentEntry, triggers: currentEntry.triggers.includes(t) ? currentEntry.triggers.filter(x => x !== t) : [...currentEntry.triggers, t] }),
                    className: `px-3 py-2 text-sm rounded-lg border-2 ${currentEntry.triggers.includes(t) ? 'bg-orange-500 text-white' : `${card} ${border} ${text}`}`
                  }, t)
                )
              )
            ),
            React.createElement('div', null,
              React.createElement('h3', { className: `text-lg font-medium mb-3 ${text}` }, 'Notes'),
              React.createElement('textarea', {
                value: currentEntry.notes,
                onChange: (e) => e.target.value.length <= 440 && setCurrentEntry({ ...currentEntry, notes: e.target.value }),
                className: `w-full p-3 border-2 ${border} ${card} ${text} rounded-lg`,
                rows: 4,
                placeholder: 'Notes...'
              }),
              React.createElement('div', { className: `text-sm ${muted} text-right` }, `${currentEntry.notes.length}/440`)
            ),
            React.createElement('div', null,
              React.createElement('h3', { className: `text-lg font-medium mb-3 ${text}` }, 'Medications'),
              React.createElement('textarea', {
                value: currentEntry.medications,
                onChange: (e) => e.target.value.length <= 240 && setCurrentEntry({ ...currentEntry, medications: e.target.value }),
                className: `w-full p-3 border-2 ${border} ${card} ${text} rounded-lg`,
                rows: 3,
                placeholder: 'Medications...'
              }),
              React.createElement('div', { className: `text-sm ${muted} text-right` }, `${currentEntry.medications.length}/240`)
            ),
            React.createElement('button', {
              onClick: save,
              className: 'w-full bg-blue-600 text-white py-4 rounded-lg font-medium'
            }, 'Save Entry')
          )
        );
      }

      const { daysInMonth, startingDayOfWeek } = (() => {
        const y = currentDate.getFullYear(), m = currentDate.getMonth();
        return { daysInMonth: new Date(y, m + 1, 0).getDate(), startingDayOfWeek: new Date(y, m, 1).getDay() };
      })();

      return React.createElement('div', { className: `max-w-2xl mx-auto ${bg} min-h-screen` },
        React.createElement('div', { className: `${card} p-4 flex justify-between items-center` },
          React.createElement('h1', { className: `text-2xl font-medium ${text}` }, 'Pain Tracker'),
          React.createElement('button', {
            onClick: () => {
              const n = !darkMode;
              setDarkMode(n);
              localStorage.setItem('dark', JSON.stringify(n));
            }
          }, darkMode ? 'â˜€ï¸' : 'ðŸŒ™')
        ),
        activeView === 'calendar' && React.createElement('div', { className: `${card} p-4` },
          React.createElement('div', { className: 'flex justify-between items-center mb-6' },
            React.createElement('button', {
              onClick: () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1)),
              className: 'p-2 text-2xl'
            }, 'â†'),
            React.createElement('h2', { className: `text-2xl font-medium ${text}` }, currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })),
            React.createElement('button', {
              onClick: () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1)),
              className: 'p-2 text-2xl'
            }, 'â†’')
          ),
          React.createElement('div', { className: 'grid grid-cols-7 gap-2 mb-2' },
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(d =>
              React.createElement('div', { key: d, className: `text-center text-sm ${muted}` }, d)
            )
          ),
          React.createElement('div', { className: 'grid grid-cols-7 gap-2' },
            Array(startingDayOfWeek).fill(0).map((_, i) => React.createElement('div', { key: i })),
            Array(daysInMonth).fill(0).map((_, i) => {
              const d = new Date(currentDate.getFullYear(), currentDate.getMonth(), i + 1);
              return React.createElement('button', {
                key: i,
                onClick: () => setSelectedDate(d),
                className: `aspect-square rounded-lg font-medium text-lg ${getColor(d)}`
              }, i + 1);
            })
          ),
          React.createElement('button', {
            onClick: () => setSelectedDate(new Date()),
            className: 'fixed bottom-20 right-4 bg-blue-600 text-white p-4 rounded-full shadow-lg z-10 text-2xl'
          }, '+')
        ),
        activeView === 'stats' && React.createElement('div', { className: `${card} p-4 pb-24` },
          React.createElement('h2', { className: `text-2xl font-medium mb-6 ${text}` }, 'Statistics'),
          Object.keys(entries).length === 0 ?
            React.createElement('p', { className: `${muted} text-center py-12` }, 'No entries yet') :
            (() => {
              const counts = {};
              let total = 0;
              Object.values(entries).forEach(e => {
                if (e.painLevels?.length) {
                  total++;
                  e.painLevels.forEach(l => counts[l] = (counts[l] || 0) + 1);
                }
              });
              const avg = total ? Object.entries(counts).reduce((s, [l, c]) => s + l * c, 0) / Object.values(counts).reduce((s, c) => s + c, 0) : 0;
              return React.createElement('div', null,
                React.createElement('div', { className: `${darkMode ? 'bg-blue-900' : 'bg-blue-50'} rounded-lg p-4 mb-6` },
                  React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                    React.createElement('div', null,
                      React.createElement('p', { className: `text-sm ${muted}` }, 'Entries'),
                      React.createElement('p', { className: `text-2xl font-bold ${darkMode ? 'text-blue-100' : 'text-blue-600'}` }, Object.keys(entries).length)
                    ),
                    React.createElement('div', null,
                      React.createElement('p', { className: `text-sm ${muted}` }, 'Pain Days'),
                      React.createElement('p', { className: `text-2xl font-bold ${darkMode ? 'text-blue-100' : 'text-blue-600'}` }, total)
                    ),
                    React.createElement('div', { className: 'col-span-2' },
                      React.createElement('p', { className: `text-sm ${muted}` }, 'Avg Pain'),
                      React.createElement('p', { className: `text-2xl font-bold ${darkMode ? 'text-blue-100' : 'text-blue-600'}` }, avg.toFixed(1))
                    )
                  )
                ),
                painLevels.map(({ level, color, title }) => {
                  const c = counts[level] || 0;
                  const p = total ? (c / total) * 100 : 0;
                  return React.createElement('div', { key: level, className: 'flex items-center gap-3 mb-2' },
                    React.createElement('div', { className: `w-8 h-8 rounded ${color} flex items-center justify-center text-white font-bold text-sm` }, level),
                    React.createElement('div', { className: 'flex-1' },
                      React.createElement('div', { className: `flex justify-between text-sm ${text}` },
                        React.createElement('span', null, title),
                        React.createElement('span', { className: muted }, `${c} days`)
                      ),
                      React.createElement('div', { className: `h-2 ${darkMode ? 'bg-gray-700' : 'bg-gray-200'} rounded-full` },
                        React.createElement('div', { className: color, style: { width: `${p}%`, height: '100%' } })
                      )
                    )
                  );
                }),
                React.createElement('button', {
                  onClick: () => {
                    const blob = new Blob([JSON.stringify(entries, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `pain-tracker-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                  },
                  className: `w-full ${darkMode ? 'bg-gray-700' : 'bg-gray-800'} text-white py-4 rounded-lg mt-6`
                }, 'â¬‡ï¸ Export Data')
              );
            })()
        ),
        React.createElement('div', { className: `fixed bottom-0 left-0 right-0 max-w-2xl mx-auto ${card} border-t ${border} flex` },
          React.createElement('button', {
            onClick: () => setActiveView('calendar'),
            className: `flex-1 py-4 flex flex-col items-center gap-1 ${activeView === 'calendar' ? 'text-blue-600' : muted}`
          }, 'ðŸ“…', React.createElement('span', { className: 'text-xs' }, 'Calendar')),
          React.createElement('button', {
            onClick: () => setActiveView('stats'),
            className: `flex-1 py-4 flex flex-col items-center gap-1 ${activeView === 'stats' ? 'text-blue-600' : muted}`
          }, 'ðŸ“Š', React.createElement('span', { className: 'text-xs' }, 'Stats'))
        )
      );
    };

    ReactDOM.render(React.createElement(PainTrackerApp), document.getElementById('root'));
  </script>
</body>
</html>
